1. 分析 url
  - 判断输入的 url 是否合法，如果不合法浏览器会使用默认的搜索引擎进行搜索。如果输入的是一个域名，默认会加上一个http前缀。

自己的电脑一般处于局域网中，要与公网服务器访问需要找到网关出口。 

1.1 发生ARP广播，找到网关ip对应的mac，因为局域网内是靠mac地址通讯； 

2. DNS 查询
  - 检查浏览器的 DNS 缓存，检查本地 hosts 文件的缓存，如果没有会向本地 DNS 服务器发送请求。
  - 主机向本地 DNS 服务器发起请求是**递归查询**，如果找到则返回，否则会向根 DNS 查询。
  - **根 DNS 查询是迭代查询**，没有域名和 IP 的对应关系，而是告知可以查询的域名服务器地址。
  - 本地 DNS 向得到的域名服务器发出请求，收到**一个域名和 IP 关系**，把结果返回给用户，并把结果保存到缓存中。
  
**DNS 底层使用 UDP 协议** 

3. TCP 建立连接
  - 拿到 IP 地址后，发生传输层的tcp三次握手连接（一定发生，因为http基于TCP连接），如果涉及到视频流等传输会用到UDP，按照协议规定的格式发送 HTTP 请求报文

4. 处理请求
  - 服务器收到 HTTP 请求报文后进行响应，主进程进行监听，创建子进程处理，选判断是否是重定向，如果是重定向则返回重定向地址。如果是静态资源则了直接返回，否则通过 REST URL 在代码层面处理返回结果，最后返回 HTTP 响应报文。

5. 接受响应 
  - 浏览器收到 HTTP 响应报文后进行解析，首先查看响应报文在状态行的状态码，根据不同的状态码做不同的事，解析 HTML、CSS、JS 等文件。构建 DOM 树，渲染树，重绘，将像素发送 GPU 进行渲染，最后将渲染结果返回给用户并进行缓存。

6. TCP 断开连接
  - 通过 TCP 的四次挥手断开连接，如果是 HTTP 1.1 则会将连接保持一小段时间。

总结一下，用到的协议依次是 ARP->DNS->TCP/UDP->HTTP
