# HTTPS
Hypertext Transfer Protocol over Secure Socket Layer

## HTTP 存在的问题
- 没有密码加密，无法保证通信内容不被窃听，攻击者可以截取客户发送的数据并得到他的信息
- 没有报文完整性验证，无法确保通信内容在传输过程中不被改变，攻击者可以篡改客户通信内容
- 没有身份鉴别，无法让通信双方确认对方的身份，攻击者可以伪装成客户或者服务器

---

HTTPS 是以安全为目标的 HTTP 通道，简单讲是 HTTP 的安全版。

## 加密原理 SSL
即 HTTP 下加入 SSL 层（HTTP over SSL），HTTPS 的安全基础是 SSL。其所用的端口号是 443。

SSL(Secure Sockets Layer)，安全套接字层，通过采用机密性、数据完整性、服务器鉴别以及客户鉴别来强化TCP，主要用于为发生在HTTP之上的事务提供安全性。

SSL 会把数据进行加密并把加密数据送往TCP套接字，在接收方，SSL读取TCP套接字中的数据并解密，然后把数据交给应用层。

HTTPS采用混合加密机制，使用非对称加密传输对称密钥来保证传输过程的安全性，之后使用对称加密进行通信来保证通信过程的效率。


## 传输过程
HTTPS 的传输过程主要分为2部分：
1. 通过SSL握手建立安全的HTTPS通道
2. 在安全的通道上进行数据传输

过程大致如下：
1. 客户发送它支持的密码算法列表，以及一个客户的不重数，不重数就是在一个协议的生存期只使用一次的数。
2. 服务器从该列表中选择一种对称加密算法（例如AES），一种公钥加密算法（例如RSA）和一种报文鉴别码算法。服务器把它的选择以及证书和一个服务器不重数返回给客户。
③ 客户通过 CA 提供的公钥验证该证书，验证成功后提取服务器的公钥，生产一个前主密钥 PMS，用服务器的公钥加密该 PMS，并将加密的 PMS 发送给服务器。

④ 客户和服务器独立地从 PMS 和不重数中计算出仅用于当前 SSL 会话的主密钥 MS，然后该 MS 被切片以生成两个密码和两个报文鉴别码密钥。自从以后，客户和服务器之间发送的所有报文均被加密和鉴别（使用报文鉴别码）。

⑤ 客户和服务器分别发送所有握手报文的一个报文鉴别码。这一步是为了使握手免受篡改危害，在第一步中客户提供的算法列表是以明文形式发送的，因此可能被攻击者截获并删除较强的算法。当客户发送一个级联它以及发送和接收的所有握手报文的报文鉴别码，服务器能够比较这个报文鉴别码和它已经接受和发送的握手报文的报文鉴别码，如果不一致就终止连接。类似的，客户也可以通过服务器发送的报文鉴别码来检查一致性。

第一步和第二步中的不重复数用于防止重放攻击，每个 TCP 会话使用不同的不重复数就可以使加密密钥不同，当收到重放的 SSL 记录时，该记录无法通过完整性检查，假冒的电子事务不会成功。

当结束 SSL 会话时，需要在类型字段中指出该记录是否是用于终止 SSL 会话的。通过包含这样一个字段，如果客户或服务器在收到一个关闭 SSL 记录之前突然收到了一个 TCP FIN，就知道遭受了截断攻击。

1. 建立连接获取证书：SSL 客户端通过 TCP 和服务器建立连接之后（443 端口），并且在一般的 TCP 连接协商（握手）过程中请求证书。即客户端发出一个消息给服务器，这个消息里面包含了自己可实现的算法列表和其它一些需要的消息，SSL 的服务器端会回应一个数据报，这里面确定了这次通信所需要的算法，然后服务器向客户端返回证书。（证书里面包含了服务器信息：域名。申请证书的公司，公共密钥）。
2. 证书验证：client 在收到服务器返回的证书后，判断签发这个整数的公共签发机构，并使用这个机构的公共密钥确认签名是否有效，客户端还会确保证书中列出的域名就是它正在连接的域名。
3. 数据加密和传输：如果确认证书有效，那么生成对称密钥并使用服务器的公共密钥进行加密。然后发送给服务器，服务器使用它的私钥对它进行解密，这样两台计算机可以开始进行对称加密进行通信。
